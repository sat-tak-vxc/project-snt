<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <apiVersion>54.0</apiVersion>
    <assignments>
        <name>assign_BankAccount</name>
        <label>口座レコード割り当て</label>
        <locationX>253</locationX>
        <locationY>483</locationY>
        <assignmentItems>
            <assignToReference>var_BankAccountRecord.BankName__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>var_BankRecord.BankName__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>var_BankAccountRecord.BankCode__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>var_BankRecord.BankCode__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>var_BankAccountRecord.BranchOfficeName__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>var_BankRecord.BranchOfficeName__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>var_BankAccountRecord.BranchOfficeCode__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>var_BankRecord.BranchOfficeCode__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>var_BankAccountRecord.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>input_ContractorName</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>var_BankAccountRecord.ContractorKana__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>input_ContractorKana</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>var_BankAccountRecord.BankAccountNum__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>input_BankAccountNum</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>var_BankAccountRecord.DepositType__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>input_DepositType</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>create_BankAccount</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>assign_BankRecord</name>
        <label>銀行マスタを取得</label>
        <locationX>457</locationX>
        <locationY>290</locationY>
        <assignmentItems>
            <assignToReference>var_BankRecord</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>get_BankRecord</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>loop_SelectedCountJude</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>assign_CountUp</name>
        <label>選択数カウント</label>
        <locationX>622</locationX>
        <locationY>174</locationY>
        <assignmentItems>
            <assignToReference>var_Counter</assignToReference>
            <operator>Add</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>decision_TwoLoopError</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>decision_NotSelectedError</name>
        <label>項目が設定されていない場合のエラー</label>
        <locationX>243</locationX>
        <locationY>176</locationY>
        <defaultConnector>
            <targetReference>dhisplay_CreateBankAccount</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>デフォルトの結果</defaultConnectorLabel>
        <rules>
            <name>NotSelectedError</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>var_Counter</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>screen_TwoSelectedError_0</targetReference>
            </connector>
            <label>項目が選択されていない</label>
        </rules>
    </decisions>
    <decisions>
        <name>decision_TwoLoopError</name>
        <label>2項目以上はエラー表示</label>
        <locationX>615</locationX>
        <locationY>330</locationY>
        <defaultConnector>
            <targetReference>get_BankRecord</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>デフォルトの結果</defaultConnectorLabel>
        <rules>
            <name>Error</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>var_Counter</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>2.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>screen_TwoSelectedError</targetReference>
            </connector>
            <label>2項目以上選択</label>
        </rules>
    </decisions>
    <dynamicChoiceSets>
        <name>choiceList_DepositType</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>DepositType__c</picklistField>
        <picklistObject>BankAccount__c</picklistObject>
    </dynamicChoiceSets>
    <interviewLabel>BA_銀行口座連携機能 {!$Flow.CurrentDateTime}</interviewLabel>
    <label>BA_銀行口座連携機能</label>
    <loops>
        <name>loop_SelectedCountJude</name>
        <label>選択数判別ループ</label>
        <locationX>456</locationX>
        <locationY>171</locationY>
        <collectionReference>selectedIds</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>assign_CountUp</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>decision_NotSelectedError</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <name>create_BankAccount</name>
        <label>口座レコード作成</label>
        <locationX>252</locationX>
        <locationY>627</locationY>
        <connector>
            <targetReference>screen_BankAccountRecordCreated</targetReference>
        </connector>
        <inputReference>var_BankAccountRecord</inputReference>
    </recordCreates>
    <recordLookups>
        <name>get_BankRecord</name>
        <label>get_BankRecord</label>
        <locationX>454</locationX>
        <locationY>425</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>assign_BankRecord</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>loop_SelectedCountJude</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Bank__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <screens>
        <name>dhisplay_CreateBankAccount</name>
        <label>口座レコード作成</label>
        <locationX>253</locationX>
        <locationY>348</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>assign_BankAccount</targetReference>
        </connector>
        <fields>
            <name>dhisplay_SelectedItem</name>
            <fieldText>&lt;p&gt;銀行名：{!var_BankRecord.BankName__c}&lt;/p&gt;&lt;p&gt;銀行コード：{!var_BankRecord.BankCode__c}&lt;/p&gt;&lt;p&gt;支店名：{!var_BankRecord.BranchOfficeName__c}&lt;/p&gt;&lt;p&gt;支店コード：{!var_BankRecord.BranchOfficeCode__c}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>input_ContractorName</name>
            <dataType>String</dataType>
            <fieldText>口座名義</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>input_ContractorKana</name>
            <dataType>String</dataType>
            <fieldText>名義カナ</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;&lt;span style=&quot;color: rgb(255, 0, 0);&quot;&gt;※カタカナのみで入力してください&lt;/span&gt;&lt;/p&gt;</errorMessage>
                <formulaExpression>REGEX( {!input_ContractorKana} , &quot;^[ァ-ー]+$&quot;)</formulaExpression>
            </validationRule>
        </fields>
        <fields>
            <name>input_DepositType</name>
            <choiceReferences>choiceList_DepositType</choiceReferences>
            <dataType>String</dataType>
            <fieldText>預金種目</fieldText>
            <fieldType>DropdownBox</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>input_BankAccountNum</name>
            <dataType>String</dataType>
            <fieldText>口座番号</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;&lt;span style=&quot;color: rgb(255, 2, 2);&quot;&gt;※入力された口座番号の桁数が不正です。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(255, 2, 2);&quot;&gt;7桁で入力してください。&lt;/span&gt;&lt;/p&gt;</errorMessage>
                <formulaExpression>LEN({!input_BankAccountNum})=7</formulaExpression>
            </validationRule>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>screen_BankAccountRecordCreated</name>
        <label>口座レコード作成完了</label>
        <locationX>252</locationX>
        <locationY>773</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>dhisplay_CreatedText</name>
            <fieldText>&lt;p&gt;口座レコードの作成が完了しました。&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>screen_TwoSelectedError</name>
        <label>2項目以上選択エラー画面</label>
        <locationX>625</locationX>
        <locationY>473</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>dhisplay_ErrorText</name>
            <fieldText>&lt;p&gt;銀行項目が2項目以上選択されたため処理が終了しました。&lt;/p&gt;&lt;p&gt;銀行項目を1つのみ選択して、処理を実行しなおしてください。&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>screen_TwoSelectedError_0</name>
        <label>2項目以上選択エラー画面</label>
        <locationX>82</locationX>
        <locationY>332</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>dhisplay_ErrorText_0</name>
            <fieldText>&lt;p&gt;項目が選択されていないため処理を終了しました。&lt;/p&gt;&lt;p&gt;項目を一つ選択しなおして再度処理を実行してください。&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>330</locationX>
        <locationY>48</locationY>
        <connector>
            <targetReference>loop_SelectedCountJude</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>contextId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>selectedIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>token</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>var_BankAccountRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>BankAccount__c</objectType>
    </variables>
    <variables>
        <name>var_BankRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Bank__c</objectType>
    </variables>
    <variables>
        <name>var_Counter</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
</Flow>
