<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>54.0</apiVersion>
    <decisions>
        <name>decision_New</name>
        <label>新規作成</label>
        <locationX>574</locationX>
        <locationY>572</locationY>
        <defaultConnectorLabel>デフォルトの結果</defaultConnectorLabel>
        <rules>
            <name>isNew</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>formula_IsNew</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>update_FifthSetConfirmOwner</targetReference>
            </connector>
            <label>新規</label>
        </rules>
        <rules>
            <name>isAccountRelation</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.OwnerPhone__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.OwnerPhone2__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.OwnerPhone3__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.OwnerPhone4__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.OwnerPhone5__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.ManagementCompanyPhone__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.OwnerProxyPhone__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>flow_FifthSetConfirmAccountRelattion</targetReference>
            </connector>
            <label>取引先紐づけ</label>
        </rules>
        <rules>
            <name>isChangeContact</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.EmployeeName__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.EmployeeName__c</leftValueReference>
                <operator>WasSet</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>update_FifthSetConfirmServiceNewRealEstate_0</targetReference>
            </connector>
            <label>社員名変更</label>
        </rules>
    </decisions>
    <decisions>
        <name>decision_New_0</name>
        <label>新規作成</label>
        <locationX>783</locationX>
        <locationY>1433</locationY>
        <defaultConnectorLabel>デフォルトの結果</defaultConnectorLabel>
        <rules>
            <name>isNew_0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>formula_IsNew</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>flow_NonconformityOwnerCheck</targetReference>
            </connector>
            <label>新規</label>
        </rules>
    </decisions>
    <decisions>
        <name>decision_ServiceNewRealEstate</name>
        <label>5点確定の社員名に紐づくサービス_新規（不動産）存在判定</label>
        <locationX>796</locationX>
        <locationY>981</locationY>
        <defaultConnector>
            <targetReference>IsDecisionApplication</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>デフォルトの結果</defaultConnectorLabel>
        <rules>
            <name>isServiceNewRealEstate</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.EmployeeName__r.CorporateHousingRegulation__r.ServiceContractNewMatterAgency__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>formula_IsNew</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>update_FifthSetConfirmServiceNewRealEstate</targetReference>
            </connector>
            <label>サービス_新規（不動産）あり</label>
        </rules>
    </decisions>
    <decisions>
        <name>IsDecisionApplication</name>
        <label>決裁申請適用</label>
        <locationX>797</locationX>
        <locationY>1178</locationY>
        <defaultConnector>
            <targetReference>update_NewMatter</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>デフォルトの結果</defaultConnectorLabel>
        <rules>
            <name>DecisionApplication</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.IsApprovalCheckTrigger__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.IsApprovalCheckTrigger__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>DecisionApplidcationLock</targetReference>
            </connector>
            <label>決裁申請</label>
        </rules>
    </decisions>
    <description>5点確定の新規作成更新時に、5点確定&gt;社員名&gt;社員規定&gt;サービス_新規（不動産）を取得し、
5点確定&gt;サービス_新規（不動産）に割当てる処理を追加</description>
    <environments>Default</environments>
    <formulas>
        <name>formula_IsNew</name>
        <dataType>Boolean</dataType>
        <expression>ISNEW()</expression>
    </formulas>
    <interviewLabel>5点確定トリガ {!$Flow.CurrentDateTime}</interviewLabel>
    <label>FS_5点確定トリガ</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordUpdates>
        <name>DecisionApplidcationLock</name>
        <label>決裁申請レコードロック</label>
        <locationX>705</locationX>
        <locationY>1322</locationY>
        <connector>
            <targetReference>decision_New_0</targetReference>
        </connector>
        <inputAssignments>
            <field>IsApprovalLock__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>update_FifthSetConfirmAccountProxyContact</name>
        <label>5点確定の企業名社員名変更</label>
        <locationX>802</locationX>
        <locationY>825</locationY>
        <connector>
            <targetReference>decision_ServiceNewRealEstate</targetReference>
        </connector>
        <inputAssignments>
            <field>Account__c</field>
            <value>
                <elementReference>$Record.NewMatter__r.Account__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>EmployeeName__c</field>
            <value>
                <elementReference>$Record.NewMatter__r.ProxyContact__c</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>update_FifthSetConfirmOwner</name>
        <label>5点確定の所有者変更</label>
        <locationX>282</locationX>
        <locationY>580</locationY>
        <connector>
            <targetReference>CreateShareObjectFifthSetConfirm</targetReference>
        </connector>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>$Setup.SyatakusanSetting__c.SystemUserId__c</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>update_FifthSetConfirmServiceNewRealEstate</name>
        <label>5点確定のサービス_新規（不動産）変更</label>
        <locationX>954</locationX>
        <locationY>944</locationY>
        <connector>
            <targetReference>IsDecisionApplication</targetReference>
        </connector>
        <inputAssignments>
            <field>ServiceContractNewMatterAgency__c</field>
            <value>
                <elementReference>$Record.EmployeeName__r.CorporateHousingRegulation__r.ServiceContractNewMatterAgency__c</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>update_FifthSetConfirmServiceNewRealEstate_0</name>
        <label>5点確定のサービス_新規（不動産）変更</label>
        <locationX>815</locationX>
        <locationY>572</locationY>
        <inputAssignments>
            <field>ServiceContractNewMatterAgency__c</field>
            <value>
                <elementReference>$Record.EmployeeName__r.CorporateHousingRegulation__r.ServiceContractNewMatterAgency__c</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>5点確定レコードを新規レコードに設定する</description>
        <name>update_NewMatter</name>
        <label>新規レコード更新</label>
        <locationX>924</locationX>
        <locationY>1325</locationY>
        <connector>
            <targetReference>decision_New_0</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.NewMatter__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>FifthSetConfirm__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <object>NewMatter__c</object>
    </recordUpdates>
    <start>
        <locationX>463</locationX>
        <locationY>50</locationY>
        <connector>
            <targetReference>UpdateStageFifthSetConfirm</targetReference>
        </connector>
        <object>FifthSetConfirm__c</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <subflows>
        <name>CreateShareObjectFifthSetConfirm</name>
        <label>FS_シェアオブジェクト作成（5点確定）</label>
        <locationX>284</locationX>
        <locationY>828</locationY>
        <connector>
            <targetReference>flow_CorporateHousingRegulationCheck</targetReference>
        </connector>
        <flowName>CreateShareObjectFifthSetConfirm</flowName>
        <inputAssignments>
            <name>RecordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <name>flow_CorporateHousingRegulationCheck</name>
        <label>社宅規定照合</label>
        <locationX>448</locationX>
        <locationY>826</locationY>
        <connector>
            <targetReference>flow_FifthSetConfirmAccountRelattion</targetReference>
        </connector>
        <flowName>CorporateHousingRegulationCheck</flowName>
        <inputAssignments>
            <name>recordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <name>flow_FifthSetConfirmAccountRelattion</name>
        <label>5点確定取引先自動紐づけ</label>
        <locationX>585</locationX>
        <locationY>824</locationY>
        <connector>
            <targetReference>update_FifthSetConfirmAccountProxyContact</targetReference>
        </connector>
        <flowName>FifthSetConfirmAccountRelation</flowName>
        <inputAssignments>
            <name>var_FifthSetConfirm</name>
            <value>
                <elementReference>$Record</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_ManagementCompanyPhone</name>
            <value>
                <elementReference>$Record.ManagementCompanyPhone__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_OwnerPhone1</name>
            <value>
                <elementReference>$Record.OwnerPhone__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_OwnerPhone2</name>
            <value>
                <elementReference>$Record.OwnerPhone2__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_OwnerPhone3</name>
            <value>
                <elementReference>$Record.OwnerPhone3__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_OwnerPhone4</name>
            <value>
                <elementReference>$Record.OwnerPhone4__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_OwnerPhone5</name>
            <value>
                <elementReference>$Record.OwnerPhone5__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_OwnerProxyPhone</name>
            <value>
                <elementReference>$Record.OwnerProxyPhone__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_PriorManagementCompanyPhone</name>
            <value>
                <elementReference>$Record__Prior.ManagementCompanyPhone__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_PriorOwnerPhone1</name>
            <value>
                <elementReference>$Record__Prior.OwnerPhone__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_PriorOwnerPhone2</name>
            <value>
                <elementReference>$Record__Prior.OwnerPhone2__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_PriorOwnerPhone3</name>
            <value>
                <elementReference>$Record__Prior.OwnerPhone3__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_PriorOwnerPhone4</name>
            <value>
                <elementReference>$Record__Prior.OwnerPhone4__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_PriorOwnerPhone5</name>
            <value>
                <elementReference>$Record__Prior.OwnerPhone5__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>var_PriorOwnerProxyPhone</name>
            <value>
                <elementReference>$Record__Prior.OwnerProxyPhone__c</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>$Record</assignToReference>
            <name>var_FifthSetConfirm</name>
        </outputAssignments>
    </subflows>
    <subflows>
        <name>flow_NonconformityOwnerCheck</name>
        <label>不適合家主チェック</label>
        <locationX>467</locationX>
        <locationY>1445</locationY>
        <flowName>NonconformityOwnerCheck</flowName>
        <inputAssignments>
            <name>var_FifthSetConfirm</name>
            <value>
                <elementReference>$Record</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <name>UpdateStageFifthSetConfirm</name>
        <label>FS_フェーズ自動更新（5点確定）</label>
        <locationX>585</locationX>
        <locationY>421</locationY>
        <connector>
            <targetReference>decision_New</targetReference>
        </connector>
        <flowName>UpdateStageFifthSetConfirm</flowName>
        <inputAssignments>
            <name>recordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
</Flow>
